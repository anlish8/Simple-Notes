<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安尼便笺</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> -->
    <link rel="stylesheet" href="css/all.min.css">
    <script src="marked/marked.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --danger-color: #f72585;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
            --gray-color: #adb5bd;
            --border-color: #e0e0e0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --max-width: 1300px;
        }

        /* 暗色主题变量 */
        :root.dark-theme {
            --primary-color: #6c8eff;
            --primary-light: #7d9fff;
            --secondary-color: #5d5ffc;
            --accent-color: #6bd9ff;
            --danger-color: #ff4081;
            --success-color: #4caf50;
            --warning-color: #ffb74d;
            --dark-color: #e0e0e0;
            --light-color: #1a1a2e;
            --gray-color: #8a8a8a;
            --border-color: #2d3748;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-theme {
            background-color: #121212;
        }

        /* 顶部统一头部 */
        .main-header {
            max-width: var(--max-width);
            width: var(--max-width);
            margin: 0 auto;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            padding: 15px 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 20;
            position: relative;
            
            background: rgba(67, 97, 238, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            
            background-image: 
                linear-gradient(135deg, 
                    rgba(67, 97, 238, 0.8) 0%, 
                    rgba(58, 12, 163, 0.8) 100%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .header-container {
            max-width: var(--max-width);
            width: var(--max-width);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 1.8rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* 筛选按钮容器 */
        .filter-container {
            display: flex;
            gap: 5px;
            margin-left: 15px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .filter-btn.active {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: white;
        }
        
        .filter-btn:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        .main-header .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* 主题切换按钮样式 */
        .theme-toggle-btn {
            width: 36px;
            height: 36px;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .theme-toggle-btn i {
            font-size: 1rem;
            color: white;
        }
        
        /* 清空所有按钮样式 */
        .main-header .btn-danger {
            background-color: rgba(247, 37, 133, 0.2);
            color: white;
            border: 1px solid rgba(247, 37, 133, 0.3);
        }
        
        .main-header .btn-danger:hover {
            background-color: rgba(247, 37, 133, 0.4);
            transform: translateY(-2px);
        }

        .main-header .btn-primary {
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .main-header .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .main-header .btn-primary:hover {
            background-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .main-header .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .main-header .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: white;
            color: var(--dark-color);
            border: 1px solid var(--border-color);
        }
        
        .dark-theme .btn-secondary {
            background-color: #2d3748;
            color: #e0e0e0;
            border: 1px solid #4a5568;
        }

        .btn-secondary:hover {
            background-color: #f5f5f5;
        }
        
        .dark-theme .btn-secondary:hover {
            background-color: #4a5568;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d81b60;
            transform: translateY(-2px);
        }

        .container {
            display: flex;
            max-width: var(--max-width);
            width: var(--max-width);
            margin: 0 auto;
            height: calc(100vh - 12vh);
            margin-top: 10px;
            gap: 18px;
        }

        /* 左侧边栏 - 宽度68% */
        .sidebar {
            width: 68%;
            background-color: white;
            border-right: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .dark-theme .sidebar {
            background-color: #1e1e2e;
            border-color: #2d3748;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-box {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: white;
            color: var(--dark-color);
        }
        
        .dark-theme .search-box {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        /* 搜索历史下拉框 */
        .search-history-dropdown {
            position: absolute;
            top: 100%;
            left: 20px;
            right: 20px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-height: 450px; /* 从300px增加到450px */
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .dark-theme .search-history-dropdown {
            background-color: #1e1e2e;
            border-color: #4a5568;
        }
        
        .search-history-dropdown.active {
            display: block;
        }
        
        .search-history-header {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: inherit;
            z-index: 1;
        }
        
        .search-history-header h4 {
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        
        .clear-history-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .clear-history-btn:hover {
            color: var(--danger-color);
        }
        
        /* 搜索历史记录按钮组 */
        .search-history-buttons {
            display: flex;
            flex-wrap: wrap; /* 允许换行 */
            gap: 6px; /* 减小间距 */
            padding: 10px;
            max-height: 380px; /* 从250px增加到380px */
            overflow-y: auto;
        }
        
        /* 搜索历史按钮样式（下拉列表中的按钮） - 改为小按钮 */
        .search-history-buttons .search-history-btn {
            padding: 5px 10px; /* 更小的内边距 */
            border: 1px solid var(--border-color);
            background-color: white;
            border-radius: 16px; /* 更圆的按钮 */
            font-size: 0.75rem; /* 更小的字体 */
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark-color);
            text-align: center;
            width: auto; /* 自适应宽度 */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 180px; /* 限制最大宽度 */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px; /* 图标和文字的间距 */
        }
        
        .dark-theme .search-history-buttons .search-history-btn {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }
        
        .search-history-buttons .search-history-btn:hover {
            background-color: rgba(67, 97, 238, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px); /* 轻微的悬停效果 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .dark-theme .search-history-buttons .search-history-btn:hover {
            background-color: rgba(108, 142, 255, 0.2);
        }
        
        /* 搜索历史按钮内的图标 */
        .search-history-btn i {
            font-size: 0.7rem;
            opacity: 0.7;
        }
        
        /* 搜索历史按钮悬停时的图标 */
        .search-history-btn:hover i {
            opacity: 1;
        }
        
        .search-history-empty {
            padding: 15px;
            text-align: center;
            color: var(--gray-color);
            font-style: italic;
            font-size: 0.9rem;
        }
        
        /* 搜索历史切换按钮样式（搜索框旁边的按钮） */
        .search-history-toggle-btn {
            position: absolute;
            right: 60px; /* 在清除按钮的左边 */
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            font-size: 1rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
            opacity: 0.6;
            z-index: 10;
        }
        
        .search-history-toggle-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--primary-color);
            opacity: 1;
        }
        
        .dark-theme .search-history-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .clear-search-btn {
            position: absolute;
            right: 30px;
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            font-size: 1rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }

        .clear-search-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--danger-color);
        }

        .clear-search-btn.visible {
            opacity: 1;
            visibility: visible;
        }

        .search-box:not(:placeholder-shown) + .clear-search-btn {
            opacity: 1;
            visibility: visible;
        }

        .memo-list-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .memo-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: min-content;
            gap: 12px;
        }

        /* 优化便笺项 - 三列显示 */
        .memo-item {
            padding: 10px;
            border-radius: var(--border-radius);
            background-color: white;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 60px;
            overflow: hidden;
        }
        
        .dark-theme .memo-item {
            background-color: #2d3748;
        }
        
        /* 完成状态样式 */
        .memo-item.completed {
            opacity: 0.7;
            background-color: #f8f9fa;
        }
        
        .dark-theme .memo-item.completed {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .memo-item.completed .memo-item-title {
            text-decoration: line-through;
            color: var(--gray-color);
        }
        
        .memo-item.completed .memo-item-index {
            color: var(--success-color);
        }

        .memo-item:hover {
            border-color: var(--success-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .memo-item.active {
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .dark-theme .memo-item.active {
            background-color: rgba(108, 142, 255, 0.1);
        }

        .memo-item-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 3px;
            gap: 8px;
        }

        .memo-item-index {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--primary-color);
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .memo-item-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark-color);
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.4;
            max-height: 2.8em;
        }
        
        .dark-theme .memo-item-title {
            color: #e0e0e0;
        }

        .memo-item-reminder {
            color: var(--warning-color);
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .memo-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .memo-item-date {
            font-size: 0.8rem;
            color: var(--gray-color);
            white-space: nowrap;
        }

        .memo-item-tag {
            font-size: 0.75rem;
            background-color: #f0f2ff;
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
        }
        
        .dark-theme .memo-item-tag {
            background-color: rgba(108, 142, 255, 0.2);
        }

        .empty-list {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
            grid-column: span 3;
        }

        .empty-list i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border-color);
        }

        /* 左侧分页控件 */
        .sidebar-pagination {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .dark-theme .sidebar-pagination {
            background-color: #1e1e2e;
            border-color: #2d3748;
        }

        .page-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .dark-theme .page-btn {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }

        .page-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        /* 右侧主内容区 - 宽度32% */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #f9fafc;
            width: 32%;
        }
        
        .dark-theme .main-content {
            background-color: #121212;
        }

        .content-area {
            flex: 1;
            padding: 0px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* 右侧详情区域 */
        .memo-detail {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        
        .dark-theme .memo-detail {
            background-color: #1e1e2e;
        }

        .memo-detail-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        
        /* 右侧详情区域操作按钮 */
        .detail-action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        /* 完成按钮样式（图形按钮） */
        .memo-detail-complete-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1rem;
        }
        
        .dark-theme .memo-detail-complete-btn {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }
        
        .memo-detail.completed .memo-detail-complete-btn {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        .memo-detail.completed .memo-detail-complete-btn:hover {
            background-color: #388e3c;
            border-color: #388e3c;
        }
        
        .memo-detail.completed .memo-detail-complete-btn i {
            opacity: 1;
        }
        
        .memo-detail-complete-btn:hover:not(.completed) {
            border-color: var(--success-color);
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .memo-detail-action-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            background-color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 2px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dark-theme .memo-detail-action-btn {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }

        .memo-detail-action-btn:hover {
            background-color: #f5f5f5;
        }
        
        .dark-theme .memo-detail-action-btn:hover {
            background-color: #4a5568;
        }

        .memo-detail-edit:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .memo-detail-delete:hover {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }
        
        .detail-status-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: var(--dark-color);
        }
        
        .status-completed {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .status-active {
            color: var(--warning-color);
            font-weight: 600;
        }

        .memo-detail-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark-color);
            line-height: 1.4;
        }
        
        .dark-theme .memo-detail-title {
            color: #e0e0e0;
        }

        .memo-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .memo-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .dark-theme .memo-detail-content {
            color: #e0e0e0;
        }

        .memo-detail-content h1,
        .memo-detail-content h2,
        .memo-detail-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }
        
        .dark-theme .memo-detail-content h1,
        .dark-theme .memo-detail-content h2,
        .dark-theme .memo-detail-content h3 {
            color: #e0e0e0;
        }

        .memo-detail-content p {
            margin-bottom: 1rem;
        }

        .memo-detail-content ul,
        .memo-detail-content ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .memo-detail-content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1.5rem 0;
            color: #666;
            font-style: italic;
        }
        
        .dark-theme .memo-detail-content blockquote {
            color: #aaa;
        }

        .memo-detail-content code {
            background-color: #f1f3f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .dark-theme .memo-detail-content code {
            background-color: #2d3748;
            color: #e0e0e0;
        }

        .memo-detail-content pre {
            background-color: #2b2d42;
            color: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        
        .dark-theme .memo-detail-content pre {
            background-color: #1a1a2e;
        }

        .memo-detail-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .memo-detail-content a:hover {
            text-decoration: underline;
        }
        
        /* 完成统计 */
        .completion-stats {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-top: 5px;
        }

        /* 模态窗口 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .dark-theme .modal-content {
            background-color: #1e1e2e;
            color: #e0e0e0;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--dark-color);
        }
        
        .dark-theme .modal-header h3 {
            color: #e0e0e0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        /* 查看模态窗口 */
        #viewModal .modal-content {
            max-width: 900px;
            height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .view-modal-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view-memo-header {
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .view-memo-title {
            font-size: 1.8rem;
            color: var(--dark-color);
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .dark-theme .view-memo-title {
            color: #e0e0e0;
        }

        .view-memo-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .view-memo-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 5px 20px 0;
            line-height: 1.7;
        }
        
        .dark-theme .view-memo-content {
            color: #e0e0e0;
        }

        .view-memo-content h1,
        .view-memo-content h2,
        .view-memo-content h3 {
            margin-top: 1.8rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }
        
        .dark-theme .view-memo-content h1,
        .dark-theme .view-memo-content h2,
        .dark-theme .view-memo-content h3 {
            color: #e0e0e0;
        }

        .view-memo-content p {
            margin-bottom: 1rem;
        }

        .view-memo-content ul,
        .view-memo-content ol {
            margin-bottom: 1rem;
            padding-left: 1.8rem;
        }

        .view-memo-content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1.2rem;
            margin: 1.5rem 0;
            color: #666;
            font-style: italic;
        }
        
        .dark-theme .view-memo-content blockquote {
            color: #aaa;
        }

        .view-memo-content code {
            background-color: #f1f3f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        
        .dark-theme .view-memo-content code {
            background-color: #2d3748;
            color: #e0e0e0;
        }

        .view-memo-content pre {
            background-color: #f8f9fa;
            color: #495057;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 14px;
            line-height: 1.5;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', Courier, monospace;
        }
        
        .dark-theme .view-memo-content pre {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #2d3748;
        }

        .view-memo-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .view-memo-content a:hover {
            text-decoration: underline;
        }

        .status-badge {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge .status-completed {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        /* 详情区域查看按钮样式 */
        .memo-detail-view:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .dark-theme .form-group label {
            color: #e0e0e0;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: white;
            color: var(--dark-color);
        }
        
        .dark-theme .form-control {
            background-color: #2d3748;
            border-color: #4a5568;
            color: #e0e0e0;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* 模态窗口中的完成状态选项 */
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .textarea-container {
            display: flex;
            flex-direction: column;
            height: 400px;
        }

        .textarea-header {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
        }

        .textarea-header h4 {
            font-size: 1.1rem;
            color: var(--dark-color);
        }
        
        .dark-theme .textarea-header h4 {
            color: #e0e0e0;
        }

        .textarea-body {
            flex: 1;
            display: flex;
            position: relative;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .text-editor, .preview-area {
            width: 50%;
            padding: 15px;
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
        }

        .text-editor {
            border: none;
            resize: none;
            outline: none;
            font-family: 'Courier New', monospace;
            border-right: 1px solid var(--border-color);
            background-color: white;
            color: var(--dark-color);
        }
        
        .dark-theme .text-editor {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #4a5568;
        }

        .preview-area {
            background-color: #f9f9f9;
        }
        
        .dark-theme .preview-area {
            background-color: #1a1a2e;
        }

        .preview-area h1,
        .preview-area h2,
        .preview-area h3 {
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--dark-color);
        }
        
        .dark-theme .preview-area h1,
        .dark-theme .preview-area h2,
        .dark-theme .preview-area h3 {
            color: #e0e0e0;
        }

        .preview-area p {
            margin-bottom: 1rem;
        }

        .preview-area ul,
        .preview-area ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .preview-area blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1.2rem 0;
            color: #666;
            font-style: italic;
        }
        
        .dark-theme .preview-area blockquote {
            color: #aaa;
        }

        .preview-area code {
            background-color: #f1f3f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        
        .dark-theme .preview-area code {
            background-color: #2d3748;
            color: #e0e0e0;
        }

        .preview-area pre {
            background-color: #2b2d42;
            color: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.2rem 0;
        }
        
        .dark-theme .preview-area pre {
            background-color: #121212;
        }

        .preview-area a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .preview-area a:hover {
            text-decoration: underline;
        }
        
        /* GitHub风格的代码块 */
        .preview-area pre,
        .memo-detail-content pre {
            background-color: #f6f8fa; /* GitHub的浅灰色 */
            color: #24292e; /* GitHub的深灰色文字 */
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.2rem 0;
            font-size: 85%;
            line-height: 1.45;
            border: 1px solid #e1e4e8; /* GitHub的边框色 */
        }
        
        .dark-theme .preview-area pre,
        .dark-theme .memo-detail-content pre {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #2d3748;
        }

        /* GitHub风格的内联代码 */
        .memo-detail-content code,
        .preview-area code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27,31,35,0.05); /* 半透明背景 */
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            color: #24292e;
        }
        
        .dark-theme .memo-detail-content code,
        .dark-theme .preview-area code {
            background-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 确认模态框 */
        .confirm-modal .modal-content {
            max-width: 500px;
        }

        .confirm-body {
            padding: 30px 20px;
            text-align: center;
        }

        .confirm-body i {
            font-size: 3rem;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .confirm-body p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .confirm-body .memo-title {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .dark-theme .confirm-body .memo-title {
            color: #e0e0e0;
        }
        
        /* 清空所有确认模态框 */
        .clear-all-modal .modal-content {
            max-width: 500px;
        }
        
        .clear-all-body {
            padding: 30px 20px;
            text-align: center;
        }
        
        .clear-all-body i {
            font-size: 3rem;
            color: var(--danger-color);
            margin-bottom: 20px;
        }
        
        .clear-all-body h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }
        
        .dark-theme .clear-all-body h4 {
            color: #e0e0e0;
        }
        
        .clear-all-body .warning-text {
            background-color: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .dark-theme .clear-all-body .warning-text {
            background-color: rgba(255, 152, 0, 0.15);
            border-color: rgba(255, 152, 0, 0.4);
        }
        
        .stats-info {
            margin: 15px 0;
            padding: 10px;
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: var(--border-radius);
        }
        
        .dark-theme .stats-info {
            background-color: rgba(108, 142, 255, 0.1);
        }
        
        .stats-info p {
            margin: 5px 0;
        }

        /* 在响应式设计中调整按钮大小 */
        @media (max-width: 768px) {
            .search-history-buttons .search-history-btn {
                font-size: 0.7rem;
                padding: 4px 8px;
                max-width: 150px;
            }
        }

        @media (max-width: 576px) {
            .search-history-buttons .search-history-btn {
                font-size: 0.65rem;
                padding: 3px 6px;
                max-width: 130px;
            }
        }

        /* 响应式设计 */
        @media (max-width: 1400px) {
            .memo-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .empty-list {
                grid-column: span 2;
            }
        }

        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 55vh;
            }
            
            .main-content {
                width: 100%;
                height: 45vh;
            }
            
            .memo-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                max-width: 90%;
            }
            
            .textarea-body {
                flex-direction: column;
            }
            
            .text-editor, .preview-area {
                width: 100%;
                height: 50%;
            }
            
            .text-editor {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }

        @media (max-width: 992px) {
            .memo-list {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .empty-list {
                grid-column: span 3;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-left {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .filter-container {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
            
            .header-buttons {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .memo-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .empty-list {
                grid-column: span 2;
            }
            
            .memo-detail {
                padding: 20px;
            }
            
            .detail-action-buttons {
                justify-content: center;
            }
            
            .theme-toggle-btn {
                width: 32px;
                height: 32px;
                padding: 6px;
            }
        }

        @media (max-width: 576px) {
            .memo-list {
                grid-template-columns: 1fr;
            }
            
            .empty-list {
                grid-column: span 1;
            }
            
            .header-left h1 {
                font-size: 1.5rem;
            }
            
            .memo-item {
                padding: 12px;
                height: 105px;
            }
            
            .memo-item-title {
                font-size: 0.9rem;
            }
            
            .memo-item-date {
                font-size: 0.75rem;
            }
            
            .memo-item-index {
                font-size: 0.8rem;
                width: 20px;
            }
        }
		
		/* 清空所有模态窗口内容区域支持滚动 */
		.clear-all-modal .modal-content {
			display: flex;
			flex-direction: column;
			max-height: 80vh; /* 限制最大高度 */
		}

		.clear-all-body {
			flex: 1;
			overflow-y: auto; /* 启用垂直滚动 */
			padding: 20px;
			max-height: 60vh; /* 设置最大高度，超出则显示滚动条 */
		}

		/* 清空所有模态窗口中的统计信息部分 */
		.clear-all-modal .stats-info {
			margin: 15px 0;
			padding: 10px;
			background-color: rgba(67, 97, 238, 0.05);
			border-radius: var(--border-radius);
			max-height: 200px; /* 限制统计信息最大高度 */
			overflow-y: auto;
		}

		/* 警告文本区域也支持滚动 */
		.clear-all-modal .warning-text {
			background-color: rgba(255, 152, 0, 0.1);
			border: 1px solid rgba(255, 152, 0, 0.3);
			border-radius: var(--border-radius);
			padding: 15px;
			margin: 20px 0;
			text-align: left;
			max-height: 150px; /* 限制最大高度 */
			overflow-y: auto;
		}

		/* 响应式调整 */
		@media (max-width: 768px) {
			.clear-all-modal .modal-content {
				max-height: 90vh; /* 在移动设备上使用更大的高度 */
			}
			
			.clear-all-body {
				max-height: 70vh; /* 移动设备上调整内容区域高度 */
			}
		}
		
		/* 清空所有模态窗口的footer固定 */
		.clear-all-modal .modal-footer {
			position: sticky;
			bottom: 0;
			background-color: inherit;
			border-top: 1px solid var(--border-color);
			padding: 20px;
			display: flex;
			justify-content: flex-end;
			gap: 10px;
		}
    </style>
    <script>
    // 配置 marked.js 选项，让链接在新标签页打开
    const renderer = new marked.Renderer();
    renderer.link = function(href, title, text) {
      const link = marked.Renderer.prototype.link.call(this, href, title, text);
      return link.replace('<a', '<a target="_blank" rel="noopener noreferrer"');
    };

    marked.use({ renderer });
    </script>
</head>
<body>
    <!-- 统一顶部头部 -->
    <header class="main-header">
        <div class="header-container">
            <div class="header-left">
                <h1><i class="fas fa-sticky-note"></i> 安尼便笺</h1>
                <div class="filter-container">
                    <button class="filter-btn active" data-filter="all">全部</button>
                    <button class="filter-btn" data-filter="active">未完成</button>
                    <button class="filter-btn" data-filter="completed">已完成</button>
                </div>
            </div>
            <div class="header-buttons">
                <button class="btn btn-success" id="addMemoBtn">
                    <i class="fas fa-plus"></i> 新增便笺
                </button>
                <button class="btn btn-secondary" id="exportBtn">
                    <i class="fas fa-download"></i> 导出
                </button>
                <button class="btn btn-secondary" id="importBtn">
                    <i class="fas fa-upload"></i> 导入
                </button>
                <!-- 新增清空所有按钮 -->
                <button class="btn btn-danger" id="clearAllBtn">
                    <i class="fas fa-trash-alt"></i> 清空所有
                </button>
                <!-- 主题切换按钮（图形按钮） -->
                <button class="theme-toggle-btn" id="themeToggleBtn" title="切换主题">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- 左侧边栏 - 宽度68% -->
        <div class="sidebar">
            <div class="search-container">
                <input type="text" class="search-box" id="searchBox" placeholder="搜索便笺...">
                <!-- 历史按钮 -->
                <button class="search-history-toggle-btn" id="searchHistoryBtn" title="搜索历史">
                    <i class="fas fa-history"></i>
                </button>
                <!-- 清除按钮 -->
                <button class="clear-search-btn" id="clearSearchBtn" title="清除搜索">
                    <i class="fas fa-times"></i>
                </button>
                <!-- 搜索历史记录按钮组 -->
                <div class="search-history-dropdown" id="searchHistoryDropdown">
                    <div class="search-history-header">
                        <h4>最近搜索</h4>
                        <button class="clear-history-btn" id="clearHistoryBtn">清除历史</button>
                    </div>
                    <div class="search-history-buttons" id="searchHistoryList">
                        <!-- 搜索历史记录按钮将在这里动态生成 -->
                    </div>
                </div>
            </div>
            
            <div class="memo-list-container">
                <div class="memo-list" id="memoList">
                    <!-- 便笺列表将通过JS动态生成 -->
                    <div class="empty-list">
                        <i class="fas fa-clipboard"></i>
                        <p>暂无便笺</p>
                        <p>点击上方按钮创建第一个便笺</p>
                    </div>
                </div>
                
                <!-- 左侧分页控件 -->
                <div class="sidebar-pagination">
                    <button class="page-btn" id="prevPage">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="page-info" id="pageInfo">第 1 页 / 共 1 页</span>
                    <button class="page-btn" id="nextPage">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 右侧主内容区 - 宽度30% -->
        <div class="main-content">
            <div class="content-area">
                <div class="memo-detail" id="memoDetail">
                    <div class="memo-detail-header">
                        <div class="detail-action-buttons">
                            <span class="status-label">状态:</span>
                            <span id="detailStatus" class="status-active">进行中</span>
                            <button class="memo-detail-complete-btn" id="detailCompleteBtn" title="标记为完成/未完成">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="memo-detail-action-btn memo-detail-edit" id="detailEditBtn" title="编辑">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="memo-detail-action-btn memo-detail-delete" id="detailDeleteBtn" title="删除">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="memo-detail-action-btn memo-detail-view" id="detailViewBtn" title="查看完整内容">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                        <div class="memo-detail-title" id="detailTitle">欢迎使用简单便笺</div>
                        <div class="memo-detail-meta">
                            <div class="meta-item" id="detailCreated" style="display:none;">
                                <i class="far fa-calendar-plus"></i>
                                <span>创建日期: -</span>
                            </div>
                            <div class="meta-item" id="detailModified">
                                <i class="far fa-calendar-check"></i>
                                <span>修改日期: -</span>
                            </div>
                            <div class="meta-item" id="detailReminder">
                                <i class="far fa-bell"></i>
                                <span>到期日期: -</span>
                            </div>
                        </div>
                        <div class="completion-stats" id="completionStats" style="display:none;"></div>
                    </div>
                    <div class="memo-detail-content" id="detailContent">
                        <p>这是一个功能完整的便笺应用，支持以下功能：</p>
                        <ul>
                            <li>按完成状态筛选</li>
                            <li>本地存储</li>
                            <li>数据导入/导出</li>
                            <li>创建、编辑、删除便笺</li>
                            <li>支持Markdown语法</li>
                            <li>搜索功能</li>
                            <li>分页显示</li>
                            <li>便笺完成状态标记</li>
                        </ul>
                        <p>请点击上方的"新增便笺"按钮创建新便笺。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 新增/编辑便笺模态窗口 -->
    <div class="modal" id="memoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">新增便笺</h3>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="memoTitle">标题</label>
                    <input type="text" id="memoTitle" class="form-control" placeholder="输入便笺标题">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="memoDate">日期</label>
                        <input type="date" id="memoDate" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="reminderDate">到期日期</label>
                        <input type="datetime-local" id="reminderDate" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>内容 (编辑 | 预览 | 支持Markdown)</label>
                    <div class="textarea-container">
                        <div class="textarea-header"></div>
                        <div class="textarea-body">
                            <textarea id="memoContent" class="text-editor" placeholder="输入便笺内容..."></textarea>
                            <div id="contentPreview" class="preview-area"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-checkbox">
                    <input type="checkbox" id="memoCompleted">
                    <label for="memoCompleted">标记为已完成</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBtn">取消</button>
                <button class="btn btn-primary" id="saveMemoBtn">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 确认删除模态窗口 -->
    <div class="modal confirm-modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="modal-close" id="closeConfirmModalBtn">&times;</button>
            </div>
            <div class="confirm-body">
                <i class="fas fa-exclamation-triangle"></i>
                <p>确定要删除便笺吗？</p>
                <p>标题: <span class="memo-title" id="confirmMemoTitle"></span></p>
                <p>此操作无法撤销！</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">确认删除</button>
            </div>
        </div>
    </div>
    
    <!-- 查看便笺完整内容模态窗口 -->
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="viewModalTitle">便笺详情</h3>
                <button class="modal-close" id="closeViewModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="view-modal-content">
                    <div class="view-memo-header">
                        <h1 id="viewTitle" class="view-memo-title" style="display:none;"></h1>
                        <div class="view-memo-meta">
                            <div class="meta-item">
                                <i class="far fa-calendar-plus"></i>
                                <span id="viewCreated">创建日期: -</span>
                            </div>
                            <div class="meta-item">
                                <i class="far fa-calendar-check"></i>
                                <span id="viewModified">修改日期: -</span>
                            </div>
                            <div class="meta-item">
                                <i class="far fa-bell"></i>
                                <span id="viewReminder">到期日期: -</span>
                            </div>
                            <div class="meta-item status-badge" id="viewStatusContainer">
                                <span id="viewStatus" class="status-active">进行中</span>
                            </div>
                        </div>
                    </div>
                    <div class="view-memo-content" id="viewContent">
                        <!-- Markdown渲染内容将在这里显示 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeViewBtn">关闭</button>
                <button class="btn btn-primary" id="editFromViewBtn">
                    <i class="fas fa-edit"></i> 编辑
                </button>
            </div>
        </div>
    </div>
    
    <!-- 清空所有确认模态窗口 -->
    <div class="modal clear-all-modal" id="clearAllModal">
        <div class="modal-content">
            <div class="clear-all-body">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>警告：清空所有便笺</h4>
                <p>您确定要清空所有便笺吗？</p>
                
                <div class="stats-info" id="clearAllStats">
                    <!-- 统计信息将通过JS动态生成 -->
                </div>
                
                <div class="warning-text">
                    <p><strong><i class="fas fa-exclamation-circle"></i> 此操作无法撤销！</strong></p>
                    <p>所有便笺数据将被永久删除，无法恢复。</p>
                    <p>建议在执行此操作前先导出备份。</p>
                </div>
                
                <p>要确认此操作，请在下方输入框中输入 "<strong>删除所有</strong>"</p>
                <input type="text" id="confirmText" class="form-control" style="margin: 15px 0;" placeholder="输入 删除所有 确认">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelClearAllBtn">取消</button>
                <button class="btn btn-danger" id="confirmClearAllBtn" disabled>
                    <i class="fas fa-trash-alt"></i> 确认清空
                </button>
            </div>
        </div>
    </div>
    
    <!-- 导入文件输入 -->
    <input type="file" id="importFileInput" style="display: none;" accept=".json">
    
    <script>
        // 应用状态
        const state = {
            memos: [],
            filteredMemos: [],
            currentMemo: null,
            currentPage: 1,
            itemsPerPage: 30,
            searchQuery: '',
            editMode: false,
            currentMemoId: null,
            currentFilter: 'all', // 'all', 'active', 'completed'
            dbReady: false, // 添加数据库就绪标志
            darkMode: false, // 暗色模式状态
            searchHistory: [] // 搜索历史记录
        };

        // 数据库相关
        let db;
        const DB_NAME = 'AdvancedMemoDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'memos';

        // DOM元素
        const elements = {
            memoList: document.getElementById('memoList'),
            searchBox: document.getElementById('searchBox'),
            clearSearchBtn: document.getElementById('clearSearchBtn'),
            addMemoBtn: document.getElementById('addMemoBtn'),
            exportBtn: document.getElementById('exportBtn'),
            importBtn: document.getElementById('importBtn'),
            clearAllBtn: document.getElementById('clearAllBtn'),
            themeToggleBtn: document.getElementById('themeToggleBtn'),
            importFileInput: document.getElementById('importFileInput'),
            
            // 搜索历史相关元素
            searchHistoryDropdown: document.getElementById('searchHistoryDropdown'),
            searchHistoryList: document.getElementById('searchHistoryList'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            searchHistoryToggleBtn: document.getElementById('searchHistoryBtn'),
            
            // 详情区域
            memoDetail: document.getElementById('memoDetail'),
            detailTitle: document.getElementById('detailTitle'),
            detailContent: document.getElementById('detailContent'),
            detailCreated: document.getElementById('detailCreated'),
            detailModified: document.getElementById('detailModified'),
            detailReminder: document.getElementById('detailReminder'),
            detailCompleteBtn: document.getElementById('detailCompleteBtn'),
            detailEditBtn: document.getElementById('detailEditBtn'),
            detailDeleteBtn: document.getElementById('detailDeleteBtn'),
            detailStatus: document.getElementById('detailStatus'),
            completionStats: document.getElementById('completionStats'),
            
            viewModal: document.getElementById('viewModal'),
            viewModalTitle: document.getElementById('viewModalTitle'),
            viewTitle: document.getElementById('viewTitle'),
            viewContent: document.getElementById('viewContent'),
            viewCreated: document.getElementById('viewCreated'),
            viewModified: document.getElementById('viewModified'),
            viewReminder: document.getElementById('viewReminder'),
            viewStatus: document.getElementById('viewStatus'),
            viewStatusContainer: document.getElementById('viewStatusContainer'),
            closeViewModalBtn: document.getElementById('closeViewModalBtn'),
            closeViewBtn: document.getElementById('closeViewBtn'),
            editFromViewBtn: document.getElementById('editFromViewBtn'),
            detailViewBtn: document.getElementById('detailViewBtn'),
            
            // 左侧分页
            prevPage: document.getElementById('prevPage'),
            nextPage: document.getElementById('nextPage'),
            pageInfo: document.getElementById('pageInfo'),
            
            // 模态窗口
            memoModal: document.getElementById('memoModal'),
            confirmModal: document.getElementById('confirmModal'),
            clearAllModal: document.getElementById('clearAllModal'),
            modalTitle: document.getElementById('modalTitle'),
            closeModalBtn: document.getElementById('closeModalBtn'),
            closeConfirmModalBtn: document.getElementById('closeConfirmModalBtn'),
            cancelBtn: document.getElementById('cancelBtn'),
            saveMemoBtn: document.getElementById('saveMemoBtn'),
            
            // 表单元素
            memoTitle: document.getElementById('memoTitle'),
            memoDate: document.getElementById('memoDate'),
            reminderDate: document.getElementById('reminderDate'),
            memoContent: document.getElementById('memoContent'),
            contentPreview: document.getElementById('contentPreview'),
            memoCompleted: document.getElementById('memoCompleted'),
            
            // 确认删除模态框
            confirmMemoTitle: document.getElementById('confirmMemoTitle'),
            cancelDeleteBtn: document.getElementById('cancelDeleteBtn'),
            confirmDeleteBtn: document.getElementById('confirmDeleteBtn'),
            
            // 清空所有模态框元素
            clearAllStats: document.getElementById('clearAllStats'),
            confirmText: document.getElementById('confirmText'),
            cancelClearAllBtn: document.getElementById('cancelClearAllBtn'),
            confirmClearAllBtn: document.getElementById('confirmClearAllBtn')
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            loadThemePreference(); // 加载主题偏好设置
            loadSearchHistory(); // 加载搜索历史
            initDB();
        });

        // 初始化IndexedDB
        function initDB() {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            
            request.onerror = (event) => {
                console.error('数据库打开失败:', event.target.error);
                showNotification('数据库初始化失败，某些功能可能无法使用', 'error');
                // 即使数据库失败，也设置事件监听器
                setupEventListeners();
                setDefaultDate();
                updateClearButton();
            };
            
            request.onsuccess = (event) => {
                db = event.target.result;
                console.log('数据库打开成功');
                state.dbReady = true;
                
                // 检查是否有数据
                checkAndInitializeData();
                
                // 设置事件监听器
                setupEventListeners();
                setDefaultDate();
                updateClearButton();
                setupFilterButtons();
            };
            
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                
                // 创建对象存储空间
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    const objectStore = db.createObjectStore(STORE_NAME, { 
                        keyPath: 'id',
                        autoIncrement: true 
                    });
                    
                    // 创建索引
                    objectStore.createIndex('title', 'title', { unique: false });
                    objectStore.createIndex('date', 'date', { unique: false });
                    objectStore.createIndex('createdAt', 'createdAt', { unique: false });
                    objectStore.createIndex('modifiedAt', 'modifiedAt', { unique: false });
                    objectStore.createIndex('completed', 'completed', { unique: false });
                    
                    console.log('对象存储空间创建成功');
                }
            };
        }

        // 检查并初始化数据
        function checkAndInitializeData() {
            if (!state.dbReady) return;
            
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.count();
            
            request.onsuccess = (event) => {
                if (event.target.result === 0) {
                    // 如果没有数据，添加示例数据
                    // addSampleData();
                } else {
                    // 如果有数据，加载数据
                    loadMemos();
                }
            };
            
            request.onerror = (event) => {
                console.error('检查数据失败:', event.target.error);
                loadMemos(); // 尝试加载数据
            };
        }
        
        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 添加便笺按钮
            elements.addMemoBtn.addEventListener('click', () => {
                openMemoModal();
            });
            
            // 导出按钮
            elements.exportBtn.addEventListener('click', exportMemos);
            
            // 导入按钮
            elements.importBtn.addEventListener('click', () => {
                elements.importFileInput.click();
            });
            
            // 导入文件选择
            elements.importFileInput.addEventListener('change', importMemos);
            
            // 清空所有按钮
            elements.clearAllBtn.addEventListener('click', openClearAllModal);
            
            // 主题切换按钮
            elements.themeToggleBtn.addEventListener('click', toggleTheme);
            
            // 搜索框事件 - 使用防抖来自动保存历史
            let searchTimeout;
            elements.searchBox.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                state.searchQuery = query;
                
                // 清除之前的计时器
                clearTimeout(searchTimeout);
                
                // 设置新的计时器，延迟1秒保存
                searchTimeout = setTimeout(() => {
                    if (query) {
                        addSearchHistory(query);
                    }
                }, 1000);
                
                filterMemos();
                renderMemoList();
                updateClearButton();
            });
            
            // 搜索框失焦时也保存（如果正在输入）
            elements.searchBox.addEventListener('blur', () => {
                if (state.searchQuery.trim()) {
                    addSearchHistory(state.searchQuery.trim());
                }
            });
            
            // 搜索框失焦时隐藏历史记录（但点击历史记录项时不会触发）
            <!-- elements.searchBox.addEventListener('blur', (e) => { -->
                <!-- // 延迟隐藏，以便点击历史记录项 -->
                <!-- setTimeout(() => { -->
                    <!-- if (!elements.searchHistoryDropdown.contains(document.activeElement)) { -->
                        <!-- elements.searchHistoryDropdown.classList.remove('active'); -->
                    <!-- } -->
                <!-- }, 200); -->
            <!-- }); -->
            
            // 搜索框按下回车时添加搜索历史
            elements.searchBox.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && state.searchQuery.trim()) {
                    addSearchHistory(state.searchQuery.trim());
                }
            });
            
            // 添加历史按钮点击事件
            elements.searchHistoryToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // 防止事件冒泡
                toggleSearchHistoryDropdown();
            });
            
            // 清除历史记录按钮
            elements.clearHistoryBtn.addEventListener('click', clearSearchHistory);
            
            // 清除搜索按钮
            elements.clearSearchBtn.addEventListener('click', clearSearch);
            
            // 分页按钮
            elements.prevPage.addEventListener('click', () => {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    renderMemoList();
                }
            });
            
            elements.nextPage.addEventListener('click', () => {
                const totalPages = Math.ceil(state.filteredMemos.length / state.itemsPerPage);
                if (state.currentPage < totalPages) {
                    state.currentPage++;
                    renderMemoList();
                }
            });
            
            // 模态窗口关闭按钮
            elements.closeModalBtn.addEventListener('click', closeMemoModal);
            elements.cancelBtn.addEventListener('click', closeMemoModal);
            elements.closeConfirmModalBtn.addEventListener('click', closeConfirmModal);
            
            // 保存便笺按钮
            elements.saveMemoBtn.addEventListener('click', saveMemo);
            
            // Markdown实时预览更新
            elements.memoContent.addEventListener('input', updatePreview);
            
            // 确认删除模态框
            elements.cancelDeleteBtn.addEventListener('click', closeConfirmModal);
            elements.confirmDeleteBtn.addEventListener('click', deleteMemo);
            
            // 清空所有确认模态框
            elements.cancelClearAllBtn.addEventListener('click', closeClearAllModal);
            elements.confirmClearAllBtn.addEventListener('click', clearAllMemos);
            
            // 清空所有确认文本输入监听
            elements.confirmText.addEventListener('input', updateClearAllButtonState);
            
            // 右侧详情区域按钮事件
            elements.detailCompleteBtn.addEventListener('click', toggleCurrentMemoComplete);
            elements.detailEditBtn.addEventListener('click', () => {
                if (state.currentMemo) {
                    openMemoModal(state.currentMemo);
                }
            });
            elements.detailDeleteBtn.addEventListener('click', () => {
                if (state.currentMemo) {
                    openConfirmModal(state.currentMemo);
                }
            });
            
            // 详情区域查看按钮
            elements.detailViewBtn.addEventListener('click', () => {
                if (state.currentMemo) {
                    openViewModal(state.currentMemo);
                }
            });

            // 查看模态窗口关闭按钮
            elements.closeViewModalBtn.addEventListener('click', closeViewModal);
            elements.closeViewBtn.addEventListener('click', closeViewModal);

            // 从查看模态窗口跳转到编辑
            elements.editFromViewBtn.addEventListener('click', () => {
                closeViewModal();
                if (state.currentMemo) {
                    openMemoModal(state.currentMemo);
                }
            });

            // 点击模态窗口外部关闭
            elements.viewModal.addEventListener('click', (e) => {
                if (e.target === elements.viewModal) {
                    closeViewModal();
                }
            });
            
            // 点击清空所有模态窗口外部关闭
            elements.clearAllModal.addEventListener('click', (e) => {
                if (e.target === elements.clearAllModal) {
                    closeClearAllModal();
                }
            });
            
            // 点击其他模态窗口外部关闭
            <!-- elements.memoModal.addEventListener('click', (e) => { -->
                <!-- if (e.target === elements.memoModal) { -->
                    <!-- closeMemoModal(); -->
                <!-- } -->
            <!-- }); -->
            
            elements.confirmModal.addEventListener('click', (e) => {
                if (e.target === elements.confirmModal) {
                    closeConfirmModal();
                }
            });
        }
        
        // 切换搜索历史下拉列表显示/隐藏
        function toggleSearchHistoryDropdown() {
            if (state.searchHistory.length === 0) {
                showNotification('暂无搜索历史', 'info');
                return;
            }
            
            elements.searchHistoryDropdown.classList.toggle('active');
        }
        
        // 点击页面其他地方时关闭搜索历史下拉列表
        document.addEventListener('click', (e) => {
            if (!elements.searchHistoryDropdown.contains(e.target) && 
                !elements.searchHistoryToggleBtn.contains(e.target) &&
                e.target !== elements.searchBox) {
                elements.searchHistoryDropdown.classList.remove('active');
            }
        });
        
        // 加载主题偏好设置
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('memoAppTheme');
            if (savedTheme === 'dark') {
                enableDarkTheme();
            } else {
                // 检查系统偏好
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    enableDarkTheme();
                }
            }
        }
        
        // 切换主题
        function toggleTheme() {
            if (state.darkMode) {
                disableDarkTheme();
            } else {
                enableDarkTheme();
            }
        }
        
        // 启用暗色主题
        function enableDarkTheme() {
            document.documentElement.classList.add('dark-theme');
            document.body.classList.add('dark-theme');
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-cloud"></i>';
            elements.themeToggleBtn.title = '切换到亮色主题';
            state.darkMode = true;
            localStorage.setItem('memoAppTheme', 'dark');
        }
        
        // 禁用暗色主题
        function disableDarkTheme() {
            document.documentElement.classList.remove('dark-theme');
            document.body.classList.remove('dark-theme');
            elements.themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
            elements.themeToggleBtn.title = '切换到暗色主题';
            state.darkMode = false;
            localStorage.setItem('memoAppTheme', 'light');
        }
        
        // 加载搜索历史
        function loadSearchHistory() {
            const savedHistory = localStorage.getItem('memoAppSearchHistory');
            if (savedHistory) {
                state.searchHistory = JSON.parse(savedHistory);
                renderSearchHistory();
            }
        }
        
        // 保存搜索历史
        function saveSearchHistory() {
            localStorage.setItem('memoAppSearchHistory', JSON.stringify(state.searchHistory));
        }
        
        // 添加搜索历史
        function addSearchHistory(query) {
            if (!query || query.trim() === '') return;
            
            // 移除重复项
            const index = state.searchHistory.findIndex(item => item.query === query);
            if (index !== -1) {
                state.searchHistory.splice(index, 1);
            }
            
            // 添加到开头
            state.searchHistory.unshift({
                query: query,
                timestamp: new Date().toISOString()
            });
            
            // 限制为20条记录
            if (state.searchHistory.length > 20) {
                state.searchHistory = state.searchHistory.slice(0, 20);
            }
            
            // 保存并更新显示
            saveSearchHistory();
            renderSearchHistory();
        }
        
        // 渲染搜索历史（改为小按钮组）
        function renderSearchHistory() {
            elements.searchHistoryList.innerHTML = '';
            
            if (state.searchHistory.length === 0) {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'search-history-empty';
                emptyItem.textContent = '暂无搜索历史';
                elements.searchHistoryList.appendChild(emptyItem);
                return;
            }
            
            state.searchHistory.forEach(item => {
                const historyButton = document.createElement('button');
                historyButton.className = 'search-history-btn';
                historyButton.dataset.query = item.query;
                historyButton.title = `搜索: ${item.query}`;
                
                // 添加图标和文字
                historyButton.innerHTML = `
                    <i class="fas fa-search"></i>
                    <span>${item.query}</span>
                `;
                
                historyButton.addEventListener('click', (e) => {
                    e.stopPropagation(); // 防止事件冒泡到document
                    const query = historyButton.dataset.query;
                    elements.searchBox.value = query;
                    state.searchQuery = query;
                    filterMemos();
                    renderMemoList();
                    updateClearButton();
                    
                    // 自动保存到历史（已经存在，但移动到这里）
                    addSearchHistory(query);
                    
                    // 关闭下拉列表
                    elements.searchHistoryDropdown.classList.remove('active');
                });
                
                elements.searchHistoryList.appendChild(historyButton);
            });
        }
        
        // 清除搜索历史
        function clearSearchHistory() {
            state.searchHistory = [];
            saveSearchHistory();
            renderSearchHistory();
            elements.searchHistoryDropdown.classList.remove('active');
            showNotification('搜索历史已清除', 'success');
        }
        
        // 打开清空所有确认模态窗口
        function openClearAllModal() {
            // 如果没有任何便笺，直接返回
            if (state.memos.length === 0) {
                showNotification('当前没有便笺可清空', 'warning');
                return;
            }
            
            // 更新统计信息
            const total = state.memos.length;
            const completed = state.memos.filter(m => m.completed).length;
            const active = total - completed;
            
            elements.clearAllStats.innerHTML = `
                <p><strong>当前便笺统计:</strong></p>
                <p>总计: ${total} 条便笺</p>
                <p>已完成: ${completed} 条</p>
                <p>未完成: ${active} 条</p>
            `;
            
            // 重置确认文本和按钮状态
            elements.confirmText.value = '';
            elements.confirmClearAllBtn.disabled = true;
            
            // 显示模态窗口
            elements.clearAllModal.classList.add('active');
            elements.confirmText.focus();
        }
        
        // 关闭清空所有确认模态窗口
        function closeClearAllModal() {
            elements.clearAllModal.classList.remove('active');
            elements.confirmText.value = '';
            elements.confirmClearAllBtn.disabled = true;
        }
        
        // 更新清空所有按钮状态（根据输入的确认文本）
        function updateClearAllButtonState() {
            const inputText = elements.confirmText.value.trim();
            elements.confirmClearAllBtn.disabled = inputText !== '删除所有';
        }
        
        // 清空所有便笺
        function clearAllMemos() {
            // 再次验证输入
            if (elements.confirmText.value.trim() !== '删除所有') {
                showNotification('请输入正确的确认文本', 'warning');
                return;
            }
            
            if (!state.dbReady) {
                showNotification('数据库未就绪', 'error');
                return;
            }
            
            // 获取对象存储空间
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const objectStore = transaction.objectStore(STORE_NAME);
            
            // 清空对象存储空间
            const clearRequest = objectStore.clear();
            
            clearRequest.onsuccess = () => {
                showNotification(`已清空所有便笺（共 ${state.memos.length} 条）`, 'success');
                closeClearAllModal();
                
                // 重置应用状态
                state.memos = [];
                state.filteredMemos = [];
                state.currentMemo = null;
                state.currentPage = 1;
                
                // 更新UI
                renderMemoList();
                updateCompletionStats();
                
                // 重置详情区域
                elements.detailTitle.textContent = '欢迎使用简单便笺';
                elements.detailContent.innerHTML = `
                    <p>所有便笺已被清空。请点击上方的"新增便笺"按钮创建新便笺。</p>
                `;
                elements.detailCreated.style.display = 'none';
                elements.detailModified.innerHTML = `
                    <i class="far fa-calendar-check"></i>
                    <span>修改日期: -</span>
                `;
                elements.detailReminder.style.display = 'none';
                elements.detailStatus.textContent = '进行中';
                elements.detailStatus.className = 'status-active';
                elements.memoDetail.classList.remove('completed');
            };
            
            clearRequest.onerror = (event) => {
                console.error('清空便笺失败:', event.target.error);
                showNotification('清空便笺失败', 'error');
            };
        }
        
        // 打开查看模态窗口
        function openViewModal(memo) {
            if (!memo) return;
            
            // 设置模态窗口标题
            elements.viewModalTitle.textContent = memo.title;
            
            // 填充内容
            elements.viewTitle.textContent = memo.title;
			
			// 兼容
            try
			{
				elements.viewContent.innerHTML = marked.parse(memo.content || '');
			} catch (error) {
				elements.viewContent.innerHTML = memo.content.replace(/\n/g, '<br>');
			}
            
            // 设置元数据
            elements.viewCreated.textContent = `创建日期: ${memo.date}`;
            elements.viewModified.textContent = `修改日期: ${formatDateTime(memo.modifiedAt)}`;
            
            if (memo.reminderDate) {
                elements.viewReminder.textContent = `到期日期: ${formatDateTime(memo.reminderDate)}`;
                elements.viewReminder.style.display = 'flex';
            } else {
                elements.viewReminder.style.display = 'none';
            }
            
            // 设置状态
            if (memo.completed) {
                elements.viewStatus.textContent = '已完成';
                elements.viewStatus.className = 'status-completed';
                elements.viewStatusContainer.className = 'meta-item status-badge';
                elements.viewStatusContainer.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
            } else {
                elements.viewStatus.textContent = '进行中';
                elements.viewStatus.className = 'status-active';
                elements.viewStatusContainer.className = 'meta-item status-badge';
                elements.viewStatusContainer.style.backgroundColor = 'rgba(255, 193, 7, 0.1)';
            }
            
            // 显示模态窗口
            elements.viewModal.classList.add('active');
        }

        // 关闭查看模态窗口
        function closeViewModal() {
            elements.viewModal.classList.remove('active');
        }
        
        // 设置筛选按钮事件
        function setupFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // 移除所有按钮的active类
                    filterButtons.forEach(b => b.classList.remove('active'));
                    // 为当前按钮添加active类
                    btn.classList.add('active');
                    
                    // 更新筛选状态
                    state.currentFilter = btn.dataset.filter;
                    filterMemos();
                    renderMemoList();
                });
            });
        }
        
        // 更新清除按钮的显示状态
        function updateClearButton() {
            if (state.searchQuery) {
                elements.clearSearchBtn.classList.add('visible');
            } else {
                elements.clearSearchBtn.classList.remove('visible');
            }
        }
        
        // 清除搜索功能
        function clearSearch() {
            elements.searchBox.value = '';
            state.searchQuery = '';
            filterMemos();
            renderMemoList();
            updateClearButton();
            setTimeout(() => {
                elements.searchHistoryDropdown.classList.remove('active');
            }, 200);
        }

        // 设置默认日期
        function setDefaultDate() {
            const now = new Date();
            
            // 获取明天日期
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            elements.memoDate.value = getLocalDateString(now);
            elements.reminderDate.value = getLocalDateTimeString(tomorrow);
        }

        // 获取本地日期字符串（YYYY-MM-DD格式）
        function getLocalDateString(date = new Date()) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 获取本地日期时间字符串（YYYY-MM-DDTHH:mm格式）
        function getLocalDateTimeString(date = new Date()) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // 加载所有便笺
        function loadMemos() {
            if (!state.dbReady) {
                console.error('数据库未就绪');
                return;
            }
            
            try {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.getAll();
                
                request.onsuccess = (event) => {
                    state.memos = event.target.result.sort((a, b) => {
                        // 先按完成状态排序（未完成的在前），再按修改时间
                        return new Date(b.modifiedAt) - new Date(a.modifiedAt);
                    });
                    
                    state.filteredMemos = [...state.memos];
                    renderMemoList();
                    updateCompletionStats();
                    
                    if (state.memos.length > 0) {
                        selectMemo(state.memos[0]);
                    }
                };
                
                request.onerror = (event) => {
                    console.error('加载便笺失败:', event.target.error);
                };
            } catch (error) {
                console.error('执行事务失败:', error);
                showNotification('加载便笺失败，请刷新页面重试', 'error');
            }
        }

        // 过滤便笺
        function filterMemos() {
            if (!state.searchQuery && state.currentFilter === 'all') {
                state.filteredMemos = [...state.memos];
                return;
            }
            
            const query = state.searchQuery.toLowerCase();
            state.filteredMemos = state.memos.filter(memo => {
                // 文本搜索
                const matchesSearch = !state.searchQuery || 
                    memo.title.toLowerCase().includes(query) || 
                    memo.content.toLowerCase().includes(query);
                
                // 完成状态筛选
                let matchesFilter = true;
                if (state.currentFilter === 'active') {
                    matchesFilter = !memo.completed;
                } else if (state.currentFilter === 'completed') {
                    matchesFilter = memo.completed === true;
                }
                
                return matchesSearch && matchesFilter;
            });
            
            state.currentPage = 1;
        }

        // 渲染便笺列表（三列布局）
        function renderMemoList() {
            elements.memoList.innerHTML = '';
            
            if (state.filteredMemos.length === 0) {
                const emptyHTML = `
                    <div class="empty-list">
                        <i class="fas fa-clipboard"></i>
                        <p>${state.searchQuery ? '未找到匹配的便笺' : '暂无便笺'}</p>
                        <p>点击上方按钮创建便笺</p>
                    </div>
                `;
                elements.memoList.innerHTML = emptyHTML;
                updatePagination();
                return;
            }
            
            // 计算分页
            const startIndex = (state.currentPage - 1) * state.itemsPerPage;
            const endIndex = startIndex + state.itemsPerPage;
            const pageMemos = state.filteredMemos.slice(startIndex, endIndex);
            
            // 计算序号
            const startNumber = startIndex + 1;
            
            // 渲染便笺项（三列布局）
            pageMemos.forEach((memo, index) => {
                const memoElement = document.createElement('div');
                memoElement.className = `memo-item ${memo.completed ? 'completed' : ''} ${state.currentMemo && state.currentMemo.id === memo.id ? 'active' : ''}`;
                memoElement.dataset.id = memo.id;
                
                // 格式化日期
                const createDate = formatDate(memo.date);
                const reminderDate = memo.reminderDate ? '到期日期：'+formatDate(memo.reminderDate) : '';
                const reminderIcon = memo.reminderDate ? 
                    `<i class="fas fa-bell memo-item-reminder" title="有提醒"></i>` : '';
                
                // 创建标签（根据内容类型）
                let tag = '';
                if (memo.content.includes('# ')) tag = '笔记';
                else if (memo.content.includes('- [ ]')) tag = '待办';
                else if (memo.content.includes('http')) tag = '链接';
                
                // 计算当前序号
                const itemNumber = startNumber + index;
                
                memoElement.innerHTML = `
                    <div class="memo-item-header">
                        <div class="memo-item-index">${itemNumber}.</div>
                        ${reminderIcon}
                        <div class="memo-item-title" title="${memo.title}">${memo.title}</div>
                    </div>
                    <div class="memo-item-footer">
                        <div class="memo-item-date">${createDate} ${reminderDate}</div>
                        ${tag ? `<div class="memo-item-tag">${tag}</div>` : ''}
                    </div>
                `;
                
                // 添加点击事件
                memoElement.addEventListener('click', (e) => {
                    selectMemo(memo);
                });
                
                elements.memoList.appendChild(memoElement);
            });
            
            updatePagination();
        }

        // 更新分页信息
        function updatePagination() {
            const totalMemos = state.filteredMemos.length;
            const totalPages = Math.max(1, Math.ceil(totalMemos / state.itemsPerPage));
            
            // 确保当前页有效
            if (state.currentPage > totalPages) {
                state.currentPage = totalPages;
            }
            
            elements.pageInfo.textContent = `第 ${state.currentPage} 页 / 共 ${totalPages} 页`;
            elements.prevPage.disabled = state.currentPage <= 1;
            elements.nextPage.disabled = state.currentPage >= totalPages;
        }
        
        // 更新完成统计信息
        function updateCompletionStats() {
            const total = state.memos.length;
            const completed = state.memos.filter(m => m.completed).length;
            const active = total - completed;
            
            elements.completionStats.textContent = `总计: ${total} | 已完成: ${completed} | 未完成: ${active}`;
        }

        // 选择便笺
        function selectMemo(memo) {
            state.currentMemo = memo;
            
            // 更新详情区域
            elements.detailTitle.textContent = memo.title;
            // 兼容
            try
			{
				elements.detailContent.innerHTML = marked.parse(memo.content || '');
			} catch (error) {
				elements.detailContent.innerHTML = memo.content.replace(/\n/g, '<br>');
			}
            
            // 更新完成状态和按钮样式
            if (memo.completed) {
                elements.detailStatus.textContent = '已完成';
                elements.detailStatus.className = 'status-completed';
                elements.memoDetail.classList.add('completed');
            } else {
                elements.detailStatus.textContent = '进行中';
                elements.detailStatus.className = 'status-active';
                elements.memoDetail.classList.remove('completed');
            }
            
            // 更新元数据
            elements.detailCreated.innerHTML = `
                <i class="far fa-calendar-plus"></i>
                <span>创建日期: ${memo.date}</span>
            `;
            elements.detailCreated.style.display = 'flex';
            
            elements.detailModified.innerHTML = `
                <i class="far fa-calendar-check"></i>
                <span>修改日期: ${formatDateTime(memo.modifiedAt)}</span>
            `;
            
            if (memo.reminderDate) {
                elements.detailReminder.innerHTML = `
                    <i class="far fa-bell" style="color: var(--warning-color);"></i>
                    <span>到期日期: ${formatDateTime(memo.reminderDate)}</span>
                `;
                elements.detailReminder.style.display = 'flex';
            } else {
                elements.detailReminder.style.display = 'none';
            }
            
            // 高亮当前选中的便笺
            document.querySelectorAll('.memo-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.id) === memo.id) {
                    item.classList.add('active');
                }
            });
        }
        
        // 切换便笺完成状态
		function toggleMemoComplete(memoId, completed) {
			if (!state.dbReady) {
				showNotification('数据库未就绪', 'error');
				return;
			}
			
			try {
				const transaction = db.transaction([STORE_NAME], 'readwrite');
				const objectStore = transaction.objectStore(STORE_NAME);
				const request = objectStore.get(memoId);
				
				request.onsuccess = (event) => {
					const memo = event.target.result;
					if (memo) {
						const oldCompleted = memo.completed;
						memo.completed = completed;
						// 完成状态修改时不更新时间，避免重新排序
						// memo.modifiedAt = new Date().toISOString();
						
						const updateRequest = objectStore.put(memo);
						updateRequest.onsuccess = () => {
							showNotification(`便笺已标记为${completed ? '完成' : '未完成'}`, 'success');
							
							// 更新内存中的便笺状态
							const memoIndex = state.memos.findIndex(m => m.id === memoId);
							if (memoIndex !== -1) {
								state.memos[memoIndex].completed = completed;
							}
							
							// 更新过滤列表中的便笺状态
							const filteredMemoIndex = state.filteredMemos.findIndex(m => m.id === memoId);
							if (filteredMemoIndex !== -1) {
								state.filteredMemos[filteredMemoIndex].completed = completed;
								
								// 如果当前筛选不是全部，可能需要从过滤列表中移除
								if ((state.currentFilter === 'active' && completed) || 
									(state.currentFilter === 'completed' && !completed)) {
									// 便笺不再符合当前筛选条件，将其从过滤列表中移除
									state.filteredMemos.splice(filteredMemoIndex, 1);
								}
							}
							
							// 重新渲染列表（但保持当前选中状态）
							renderMemoList();
							
							// 如果当前正在查看这个便笺，更新详情视图
							if (state.currentMemo && state.currentMemo.id === memoId) {
								// 如果便笺被移出过滤列表（不符合当前筛选条件）
								if ((state.currentFilter === 'active' && completed) || 
									(state.currentFilter === 'completed' && !completed)) {
									// 当前便笺不再符合筛选条件，清空详情区域
									state.currentMemo = null;
									resetDetailView();
								} else {
									// 更新当前便笺状态并刷新详情视图
									state.currentMemo.completed = completed;
									selectMemo(state.currentMemo);
								}
							}
							
							// 更新完成统计
							updateCompletionStats();
						};
						
						updateRequest.onerror = (event) => {
							console.error('更新便笺失败:', event.target.error);
							// 恢复原来的完成状态
							if (memo) memo.completed = oldCompleted;
							showNotification('更新失败', 'error');
						};
					}
				};
				
				request.onerror = (event) => {
					console.error('获取便笺失败:', event.target.error);
					showNotification('操作失败', 'error');
				};
			} catch (error) {
				console.error('执行事务失败:', error);
				showNotification('操作失败，请重试', 'error');
			}
		}
		
		// 重置详情区域显示
		function resetDetailView() {
			elements.detailTitle.textContent = '欢迎使用简单便笺';
			elements.detailContent.innerHTML = `
				<p>这是一个功能完整的便笺应用，支持以下功能：</p>
				<ul>
					<li>按完成状态筛选</li>
					<li>本地存储</li>
					<li>数据导入/导出</li>
					<li>创建、编辑、删除便笺</li>
					<li>支持Markdown语法</li>
					<li>搜索功能</li>
					<li>分页显示</li>
					<li>便笺完成状态标记</li>
				</ul>
				<p>请在左侧列表中选择一个便笺，或点击上方的"新增便笺"按钮创建新便笺。</p>
			`;
			elements.detailCreated.style.display = 'none';
			elements.detailModified.innerHTML = `
				<i class="far fa-calendar-check"></i>
				<span>修改日期: -</span>
			`;
			elements.detailReminder.style.display = 'none';
			elements.detailStatus.textContent = '进行中';
			elements.detailStatus.className = 'status-active';
			elements.memoDetail.classList.remove('completed');
		}
        
        // 切换当前查看便笺的完成状态
        function toggleCurrentMemoComplete() {
            if (!state.currentMemo) return;
            
            const completed = !state.currentMemo.completed;
            toggleMemoComplete(state.currentMemo.id, completed);
        }

        // 打开便笺模态窗口
        function openMemoModal(memo = null) {
            state.editMode = memo !== null;
            
            // 设置模态窗口标题
            elements.modalTitle.textContent = state.editMode ? '编辑便笺' : '新增便笺';
            
            // 设置表单数据
            if (memo) {
                elements.memoTitle.value = memo.title;
                elements.memoDate.value = memo.date;
                elements.reminderDate.value = memo.reminderDate ? 
                    memo.reminderDate.slice(0, 16) : '';
                elements.memoContent.value = memo.content;
                elements.memoCompleted.checked = memo.completed || false;
                state.currentMemoId = memo.id;
            } else {
                elements.memoTitle.value = '';
                elements.memoDate.value = getLocalDateString();
                elements.reminderDate.value = '';
                elements.memoContent.value = '';
                elements.memoCompleted.checked = false;
                state.currentMemoId = null;
            }
            
            // 更新预览
            updatePreview();
            
            // 显示模态窗口
            elements.memoModal.classList.add('active');
            elements.memoTitle.focus();
        }

        // 关闭便笺模态窗口
        function closeMemoModal() {
            elements.memoModal.classList.remove('active');
        }
        
        // 打开确认删除模态窗口
        function openConfirmModal(memo) {
            state.currentMemo = memo;
            elements.confirmMemoTitle.textContent = memo.title;
            elements.confirmModal.classList.add('active');
        }

        // 关闭确认删除模态窗口
        function closeConfirmModal() {
            elements.confirmModal.classList.remove('active');
        }

        // 更新Markdown预览
        function updatePreview() {
            const content = elements.memoContent.value;
			// 兼容
            try
			{
				elements.contentPreview.innerHTML = marked.parse(content || '**预览将在此处显示...**');
			} catch (error) {
				elements.contentPreview.innerHTML = content.replace(/\n/g, '<br>');
			}
        }

        // 保存便笺
        function saveMemo() {
            if (!state.dbReady) {
                showNotification('数据库未就绪', 'error');
                return;
            }
            
            const title = elements.memoTitle.value.trim();
            const date = elements.memoDate.value;
            const reminderDate = elements.reminderDate.value;
            const content = elements.memoContent.value.trim();
            const completed = elements.memoCompleted.checked;
            
            if (!title) {
                showNotification('请输入便笺标题', 'warning');
                elements.memoTitle.focus();
                return;
            }
            
            const now = new Date().toISOString();
            const memo = {
                title,
                date,
                reminderDate: reminderDate ? new Date(reminderDate).toISOString() : null,
                content,
                completed: completed,
                modifiedAt: now
            };
            
            if (state.editMode) {
                // 更新现有便笺
                memo.id = state.currentMemoId;
                memo.createdAt = state.currentMemo.createdAt;
                
                updateMemoInDB(memo);
            } else {
                // 创建新便笺
                memo.createdAt = now;
                
                addMemoToDB(memo);
            }
            
            closeMemoModal();
        }

        // 向数据库添加便笺
        function addMemoToDB(memo) {
            try {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.add(memo);
                
                request.onsuccess = () => {
                    showNotification('便笺创建成功', 'success');
                    loadMemos();
                };
                
                request.onerror = (event) => {
                    console.error('添加便笺失败:', event.target.error);
                    showNotification('便笺创建失败', 'error');
                };
            } catch (error) {
                console.error('执行事务失败:', error);
                showNotification('操作失败，请重试', 'error');
            }
        }

        // 更新数据库中的便笺
        function updateMemoInDB(memo) {
            try {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.put(memo);
                
                request.onsuccess = () => {
                    showNotification('便笺更新成功', 'success');
                    loadMemos();
                };
                
                request.onerror = (event) => {
                    console.error('更新便笺失败:', event.target.error);
                    showNotification('便笺更新失败', 'error');
                };
            } catch (error) {
                console.error('执行事务失败:', error);
                showNotification('操作失败，请重试', 'error');
            }
        }

        // 删除便笺
        function deleteMemo() {
            if (!state.currentMemo || !state.dbReady) return;
            
            try {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.delete(state.currentMemo.id);
                
                request.onsuccess = () => {
                    showNotification('便笺删除成功', 'success');
                    closeConfirmModal();
                    loadMemos();
                    
                    // 清空详情区域
                    state.currentMemo = null;
                    elements.detailTitle.textContent = '欢迎使用简单便笺';
                    elements.detailContent.innerHTML = `
                        <p>便笺已删除。请在左侧列表中选择一个便笺，或点击上方的"新增便笺"按钮创建新便笺。</p>
                    `;
                    elements.detailCreated.style.display = 'none';
                    elements.detailModified.innerHTML = `
                        <i class="far fa-calendar-check"></i>
                        <span>修改日期: -</span>
                    `;
                    elements.detailReminder.style.display = 'none';
                    elements.detailStatus.textContent = '进行中';
                    elements.detailStatus.className = 'status-active';
                    elements.memoDetail.classList.remove('completed');
                    elements.completionStats.style.display = 'none';
                };
                
                request.onerror = (event) => {
                    console.error('删除便笺失败:', event.target.error);
                    showNotification('便笺删除失败', 'error');
                };
            } catch (error) {
                console.error('执行事务失败:', error);
                showNotification('操作失败，请重试', 'error');
            }
        }

        // 导出便笺
        function exportMemos() {
            const dataStr = JSON.stringify(state.memos, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `memos_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('便笺导出成功', 'success');
        }

        // 导入便笺
        function importMemos(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedMemos = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedMemos)) {
                        throw new Error('文件格式不正确，必须是JSON数组格式');
                    }
                    
                    if (importedMemos.length === 0) {
                        throw new Error('文件中没有便笺数据');
                    }
                    
                    // 验证和清理数据
                    const validMemos = importedMemos.filter(memo => 
                        memo && 
                        typeof memo === 'object' && 
                        memo.title && 
                        typeof memo.title === 'string' &&
                        // memo.content && 
                        typeof memo.content === 'string' &&
                        memo.date && 
                        typeof memo.date === 'string'
                    ).map(memo => {
                        // 创建一个新的便笺对象，删除原始ID，让IndexedDB自动生成
                        const cleanMemo = {
                            title: memo.title.trim(),
                            content: memo.content.trim(),
                            date: memo.date,
                            reminderDate: memo.reminderDate ? new Date(memo.reminderDate).toISOString() : null,
                            completed: memo.completed !== undefined ? Boolean(memo.completed) : false,
                            createdAt: memo.createdAt ? new Date(memo.createdAt).toISOString() : new Date().toISOString(),
                            modifiedAt: new Date().toISOString()
                        };
                        
                        // 验证和修复日期格式
                        if (isNaN(new Date(cleanMemo.date))) {
                            cleanMemo.date = new Date().toISOString().split('T')[0];
                        }
                        
                        // 确保reminderDate是有效的日期
                        if (cleanMemo.reminderDate && isNaN(new Date(cleanMemo.reminderDate))) {
                            cleanMemo.reminderDate = null;
                        }
                        
                        return cleanMemo;
                    });
                    
                    if (validMemos.length === 0) {
                        throw new Error('文件中没有有效的便笺数据。请确保每条便笺包含title、content和date字段');
                    }
                    
                    if (!state.dbReady) {
                        showNotification('数据库未就绪', 'error');
                        return;
                    }
                    
                    // 批量导入
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    let importCount = 0;
                    let errorCount = 0;
                    
                    // 为每个便笺添加事件监听器
                    const importPromises = validMemos.map((memo, index) => {
                        return new Promise((resolve, reject) => {
                            const request = objectStore.add(memo);
                            
                            request.onsuccess = () => {
                                importCount++;
                                resolve();
                            };
                            
                            request.onerror = (event) => {
                                console.error(`导入便笺 ${index + 1} 失败:`, event.target.error);
                                errorCount++;
                                // 即使单个失败也继续导入，所以不reject
                                resolve();
                            };
                        });
                    });
                    
                    // 等待所有导入完成
                    Promise.all(importPromises).then(() => {
                        transaction.oncomplete = () => {
                            let message = `成功导入 ${importCount} 条便笺`;
                            if (errorCount > 0) {
                                message += `，${errorCount} 条导入失败`;
                            }
                            showNotification(message, errorCount > 0 ? 'warning' : 'success');
                            loadMemos();
                        };
                        
                        transaction.onerror = (event) => {
                            console.error('导入事务失败:', event.target.error);
                            showNotification(`导入失败: ${event.target.error?.message || '未知错误'}`, 'error');
                        };
                    });
                    
                } catch (error) {
                    console.error('解析文件失败:', error);
                    showNotification(`导入失败: ${error.message}`, 'error');
                }
                
                // 清除文件输入
                event.target.value = '';
            };
            
            reader.onerror = () => {
                showNotification('读取文件失败，请检查文件格式和权限', 'error');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        // 格式化日期时间
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 移除现有通知
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // 创建新通知
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // 添加样式
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background-color: ${type === 'success' ? 'var(--success-color)' : 
                                 type === 'error' ? 'var(--danger-color)' : 
                                 type === 'warning' ? 'var(--warning-color)' : 'var(--primary-color)'};
                color: white;
                padding: 15px 20px;
                border-radius: var(--border-radius);
                display: flex;
                align-items: center;
                gap: 10px;
                box-shadow: var(--shadow);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            // 添加动画
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease forwards';
                
                // 添加滑出动画
                const slideOutStyle = document.createElement('style');
                slideOutStyle.textContent = `
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(slideOutStyle);
                
                setTimeout(() => {
                    notification.remove();
                    document.head.removeChild(slideOutStyle);
                }, 300);
            }, 3000);
        }
        
        // 添加一些示例数据（首次使用时）
        function addSampleData() {
            if (!state.dbReady) return;
            
            const sampleMemos = [
                {
                    title: "项目会议记录 - 讨论下一季度开发计划",
                    date: new Date().toISOString().split('T')[0],
                    content: "# 项目会议记录\n\n## 会议主题\n新功能开发计划\n\n## 参会人员\n- 张三\n- 李四\n- 王五\n\n## 会议纪要\n1. 确定下个季度开发目标\n2. 分配各人任务\n3. 确定时间节点",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    reminderDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    completed: false
                },
                {
                    title: "本周购物清单 - 包括食品和生活用品",
                    date: new Date().toISOString().split('T')[0],
                    content: "## 本周购物清单\n\n### 食品类\n- [ ] 牛奶\n- [ ] 鸡蛋\n- [ ] 面包\n- [ ] 水果\n\n### 生活用品\n- [ ] 洗发水\n- [ ] 牙膏\n- [ ] 纸巾",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                },
                {
                    title: "学习计划表 - JavaScript高级课程",
                    date: new Date().toISOString().split('T')[0],
                    content: "## 本月学习计划\n\n### 目标\n完成JavaScript高级课程学习\n\n### 时间安排\n- **周一、周三**：晚上8-10点学习\n- **周六**：上午复习\n\n### 学习内容\n1. 闭包和作用域\n2. 异步编程\n3. 模块化开发",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    reminderDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    completed: true
                },
                {
                    title: "旅行计划 - 杭州西湖周末游",
                    date: new Date().toISOString().split('T')[0],
                    content: "# 周末旅行计划\n\n## 目的地\n杭州西湖\n\n## 行程安排\n1. 周六上午：出发\n2. 周六下午：游览西湖\n3. 周日上午：灵隐寺\n4. 周日下午：返回\n\n## 注意事项\n- 带上相机\n- 查看天气预报\n- 提前预订酒店",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                },
                {
                    title: "读书笔记 - 《JavaScript高级程序设计》",
                    date: new Date().toISOString().split('T')[0],
                    content: "# 《JavaScript高级程序设计》读书笔记\n\n## 第4章：变量、作用域与内存\n\n### 关键知识点\n1. 原始值与引用值\n2. 执行上下文与作用域链\n3. 垃圾回收机制\n\n## 第5章：基本引用类型\n\n### 关键知识点\n1. Date类型的使用\n2. RegExp正则表达式\n3. 原始值包装类型",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                },
                {
                    title: "健身计划 - 每周三次训练安排",
                    date: new Date().toISOString().split('T')[0],
                    content: "## 每周健身计划\n\n### 周一：胸部训练\n- 卧推 4×12\n- 上斜卧推 3×10\n- 哑铃飞鸟 3×12\n\n### 周三：背部训练\n- 引体向上 4×力竭\n- 划船 3×10\n- 下拉 3×12\n\n### 周五：腿部训练\n- 深蹲 4×10\n- 腿举 3×12\n- 腿弯举 3×15",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: true
                },
                {
                    title: "项目进度报告 - 本周工作总结与下周计划",
                    date: new Date().toISOString().split('T')[0],
                    content: "# 项目进度报告\n\n## 本周完成\n1. 用户登录模块开发完成\n2. 数据库设计优化\n3. 前端界面初步设计\n\n## 下周计划\n1. 权限管理模块开发\n2. 数据可视化功能实现\n3. 系统测试准备",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                },
                {
                    title: "会议安排 - 本周工作日程与会议时间",
                    date: new Date().toISOString().split('T')[0],
                    content: "## 本周会议安排\n\n### 周一\n- 9:00 团队周会\n- 14:00 项目评审\n\n### 周三\n- 10:00 产品需求讨论\n- 15:00 技术方案评审\n\n### 周五\n- 9:00 进度汇报会\n- 16:00 下周计划安排",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                },
                {
                    title: "创意想法 - 便笺应用功能改进建议",
                    date: new Date().toISOString().split('T')[0],
                    content: "# 创意想法收集\n\n## 新功能建议\n1. 语音便笺功能\n2. 图片附件支持\n3. 便笺分类标签\n\n## 界面优化\n1. 夜间模式\n2. 主题颜色自定义\n3. 快捷键支持",
                    createdAt: new Date().toISOString(),
                    modifiedAt: new Date().toISOString(),
                    completed: false
                }
            ];
            
            try {
                // 批量添加示例数据
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                
                sampleMemos.forEach(memo => {
                    objectStore.add(memo);
                });
                
                transaction.oncomplete = () => {
                    console.log('示例数据添加成功');
                    loadMemos();
                };
                
                transaction.onerror = (event) => {
                    console.error('添加示例数据失败:', event.target.error);
                    showNotification('添加示例数据失败', 'error');
                };
            } catch (error) {
                console.error('执行事务失败:', error);
                showNotification('添加示例数据失败，请重试', 'error');
            }
        }
    </script>
</body>
</html>